<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>奧索賓果分析器</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <style>
        .ball { background: #007bff; color: white; border-radius: 50%; width: 40px; height: 40px; display: inline-block; margin: 2px; text-align: center; line-height: 40px; font-weight: bold; }
        .swiper { height: 200px; }
    </style>
</head>
<body class="p-3">
    <div class="container-fluid">
        <!-- 當期 -->
        <h3 id="current-period" class="text-center mb-4"></h3>
        
        <!-- 左右滑動期數 -->
        <div class="swiper my-4" id="swiper-container">
            <div class="swiper-wrapper" id="periods-wrapper"></div>
            <div class="swiper-button-next"></div>
            <div class="swiper-button-prev"></div>
        </div>
        
        <!-- 統計 -->
        <h5 class="mt-4">當天統計</h5>
        <canvas id="stats-chart" height="200"></canvas>
        <div id="stats-list" class="mt-3"></div>
        
        <!-- 模擬下注 -->
        <div class="mt-5 card p-3">
            <h6>模擬下注 (虛擬)</h6>
            <input type="text" id="bet-input" class="form-control mb-2" placeholder="號碼如 1,5,10">
            <div class="d-flex gap-2">
                <button class="btn btn-primary flex-fill" onclick="simulate()">下注 100 元</button>
                <button class="btn btn-secondary" onclick="randomBet()">隨機選號</button>
            </div>
            <p id="bet-result" class="mt-2"></p>
        </div>
    </div>

<script>
    let periods = [];
    const swiper = new Swiper('#swiper-container', {
        slidesPerView: 'auto',
        spaceBetween: 10,
        navigation: { nextEl: '.swiper-button-next', prevEl: '.swiper-button-prev' },
        breakpoints: { 768: { slidesPerView: 3 } }
    });

    async function fetchData() {
        const proxyUrls = [
    'https://api.allorigins.win/raw?url=',
    'https://corsproxy.io/?',
    ''  // 直接 fetch 若網站允許
];

        const urls = [
            encodeURIComponent('https://lotto.auzonet.com/bingobingoV1.php'),  // 穩定版
            encodeURIComponent('https://lotto.auzo.tw/bingobingo.php')
        ];
        
        for(let url of urls) {
            try {
                const resp = await fetch(proxy + url);
                const html = await resp.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const text = doc.body.textContent;
                
                // 正確 regex (無多餘反斜線)
                const matches = [...text.matchAll(/(\d{9})\s+([\d\s]{40,})/g)];
                if(matches.length) {
                    const today = new Date().toISOString().slice(5,10).replace('-','');
                    periods = matches
                        .map(m => ({ 
                            period: m[1], 
                            numbers: m[2].trim().split(/\s+/).map(Number).filter(n => n > 0).slice(0,20) 
                        }))
                        .filter(p => p.numbers.length === 20 && p.period.includes(today))
                        .slice(0,20);
                    
                    if(periods.length) {
                        updateUI();
                        return;
                    }
                }
            } catch(e) {
                console.log('來源失敗:', e);
            }
        }
        document.getElementById('current-period').innerText = '暫無當天資料，5分後重試';
    }

    function updateUI() {
        if (!periods.length) return;
        
        const cur = periods[0];
        document.getElementById('current-period').innerHTML = 
            `第 ${cur.period} 期 <br> ${cur.numbers.map(n => `<span class="ball">${n}</span>`).join('')}`;
        
        const wrapper = document.getElementById('periods-wrapper');
        wrapper.innerHTML = periods.map(p => 
            `<div class="swiper-slide text-center p-2 bg-light rounded">
                <div class="fw-bold">${p.period}</div>
                <div class="small">${p.numbers.slice(0,5).join(' ')}...</div>
            </div>`
        ).join('');
        swiper.update();
        updateStats();  // 記得呼叫統計
    }

    // ... (updateStats, simulate 等函數保持原樣，從之前完整碼複製)

    fetchData();
    setInterval(fetchData, 300000);  // 每5分鐘
</script>

        function updateUI() {
            if (!periods.length) return;
            
            // 當期
            const cur = periods[0];
            document.getElementById('current-period').innerHTML = 
                `第 ${cur.period} 期 <small class="text-muted">開獎球: ${cur.numbers.map(n => `<span class="ball">${n}</span>`).join('')}</small>`;
            
            // 滑動
            const wrapper = document.getElementById('periods-wrapper');
            wrapper.innerHTML = periods.map(p => 
                `<div class="swiper-slide text-center p-2 bg-light rounded">
                    <div>${p.period}</div>
                    <div>${p.numbers.slice(0,5).join(' ')}...</div>
                </div>`
            ).join('');
            swiper.update();
            
            // 統計
            updateStats();
        }

        function updateStats() {
            const allNums = periods.flatMap(p => p.numbers);
            const counter = {};
            allNums.forEach(n => counter[n] = (counter[n] || 0) + 1);
            
            const hot = Object.entries(counter).filter(([_,c]) => c>=3).sort((a,b)=>b[1]-a[1]).slice(0,10);
            const cold = [];
            for(let i=1; i<=80; i++) if(!counter[i]) cold.push(i);
            
            const pairs = [];
            periods.forEach(p => {
                for(let j=0; j<p.numbers.length-1; j++) {
                    const pair = [Math.min(p.numbers[j],p.numbers[j+1]), Math.max(p.numbers[j],p.numbers[j+1])];
                    pairs.push(pair.join(','));
                }
            });
            const pairCounter = {};
            pairs.forEach(pr => pairCounter[pr] = (pairCounter[pr] || 0) + 1);
            const hotPairs = Object.entries(pairCounter).filter(([_,c])=>c>=2).slice(0,10);
            
            // 圖表
            new Chart(document.getElementById('stats-chart'), {
                type: 'doughnut',
                data: {
                    labels: ['熱門球', '冷門球'],
                    datasets: [{ data: [hot.length, cold.length.slice(0,10).length], backgroundColor: ['#ff6384', '#36a2eb'] }]
                }
            });
            
            // 清單
            document.getElementById('stats-list').innerHTML = `
                <div class="row">
                    <div class="col-6"><strong>熱門球 (${hot.length}):</strong> ${hot.map(([n])=>`<span class="ball">${n}</span>`).join('')}</div>
                    <div class="col-6"><strong>冷門球:</strong> ${cold.slice(0,10).join(' ')}</div>
                    <div class="col-12 mt-2"><strong>熱門連號 (${hotPairs.length}):</strong> ${hotPairs.map(([p])=>p).join(' ')}</div>
                </div>`;
        }

        function simulate() {
            const bet = document.getElementById('bet-input').value.split(',').map(n=>+n).filter(n=>n);
            if(bet.length<1) return alert('請輸入號碼');
            
            // 基於當前趨勢模擬下一期
            const simNums = [];
            // 加熱門權重
            const candidates = [];
            periods.flatMap(p=>p.numbers).forEach(n => candidates.push(n));
            while(simNums.length<20) {
                const rand = candidates[Math.floor(Math.random()*candidates.length)];
                if(!simNums.includes(rand)) simNums.push(rand);
            }
            
            const hits = bet.filter(n=>simNums.includes(n)).length;
            document.getElementById('bet-result').innerHTML = 
                `<span class="text-success">中 ${hits} 球！模擬獎金: ${hits * 50} 元</span><br>
                下一期模擬: ${simNums.slice(0,10).join(' ')}...`;
        }

        function randomBet() {
            const bet = Array.from({length:5}, ()=>Math.floor(Math.random()*80)+1).sort((a,b)=>a-b);
            document.getElementById('bet-input').value = bet.join(',');
        }

        // 啟動
        fetchData();
        setInterval(fetchData, 300000);  // 5分鐘更新
    </script>
</body>
</html>
